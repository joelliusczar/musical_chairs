server {
	listen 80;
	server_name {{server_name}};

	return 301 https://$host$request_uri;
}

server {
	listen {{listen}};

	#should be the public key
	ssl_certificate {{cert_files["public"]}};

	#should be the private key
	ssl_certificate_key {{cert_files["private"]}};

	#should be the intermediate key if relevant
	#apparently this isn't needed anymore with porkbun?
	#ssl_trusted_certificate <ssl_intermediate>;

	proxy_set_header X-Real-IP $remote_addr;
	location /api/v1/ {
		proxy_pass http://127.0.0.1:{{api_port}}/;

		location /api/v1/song-info/upload {
			client_max_body_size 0;
		}
	}

	location /docs {
		proxy_pass http://127.0.0.1:{{api_port}}/docs;
	}

	location /openapi.json {
		proxy_pass http://127.0.0.1:{{api_port}};
	}

	location /listen/stream/ {
		proxy_pass http://127.0.0.1:8000/;
	}

	location / {
		root {{serve_dir}};
		try_files $uri /index.html =404;
	}
	server_name {{server_name}};
}
